<!DOCTYPE html>
<html>
    <head>
            <style>
        #map {
          height: 100vh;
          /* width: 50vw; */
        }
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
        }
        </style>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXK1lum1zgLcoIodIKfbowX2Up4qLzwoU&libraries=places&callback=initMap" async defer></script>

        <script>
            $(document).ready(initializeApp);

            var map;
            var infowindow;
            var latitude;
            var longitude;

            function initializeApp(){
                $("#submit").on("click", getZipValue);
            }

            function getZipValue() {
                var zipcodeNumber = $("#zipcode").val();
                console.log(zipcodeNumber);
                var lng="";
                var lat="";
                var address = zipcodeNumber;
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({ 'address': address }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        latitude = results[0].geometry.location.lat();
                        longitude = results[0].geometry.location.lng();
                        console.log(latitude, longitude);
                    } else {
                        console.log("failed");
                    }
                });
            };

            function initMap() {
            //Initial location is LearningFuze
                var currLocation = {lat: 33.634875, lng: -117.740481};
                // var currLocation = {lat: latitude, lng: longitude};
                console.log(currLocation);
                map = new google.maps.Map(document.getElementById('map'), {
                    center: currLocation,
                    zoom: 13
                    });
                
                infowindow = new google.maps.InfoWindow();
                var service = new google.maps.places.PlacesService(map);
                service.nearbySearch({
                    location: currLocation,
                    radius: 5000,
                    type: ['bakery'],
                    openNow: true,
                    keyword: 'cupcake'
                }, callback);
            }

            function callback(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    for (let place = 0; place < results.length; place++) {
                    createMarker(results[place]);
                    }
                }
            }

            function createMarker(place) {
                var placeLoc = place.geometry.location;

                var image = {
                    url: 'https://i.imgur.com/rRKHpfe.png',
                    scaledSize: new google.maps.Size(30, 30)
                    };

                var cupcakeMarker = new google.maps.Marker({
                    map: map,
                    icon: image,
                    animation: google.maps.Animation.DROP,
                    position: place.geometry.location
                });

                google.maps.event.addListener(cupcakeMarker, 'click', function() {
                    infowindow.setContent(place.name);
                    infowindow.open(map, this);
                });
            }


        </script>
        
    </head>
    <body>
        <label>Address: <input type="text" id="zipcode" style="width:200px" title="Address to Geocode" value=""></label>
        <input type="button" id="submit" style="width: 150px" title="Zipcode" value="Zipcode">
        <div id="map"></div>
    </body>
</html>
